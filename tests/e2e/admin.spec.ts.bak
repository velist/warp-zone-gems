import { test, expect } from '@playwright/test';

test.describe('ç®¡ç†å‘˜åŠŸèƒ½æµ‹è¯•', () => {
  test('åº”è¯¥èƒ½å¤Ÿè®¿é—®å¼€å‘ç¯å¢ƒç®¡ç†å‘˜è®¾ç½®', async ({ page }) => {
    await page.goto('/#/admin/dev-setup');
    
    // éªŒè¯é¡µé¢æ ‡é¢˜
    await expect(page.getByRole('heading', { name: /å¼€å‘ç¯å¢ƒç®¡ç†å‘˜è®¾ç½®/i })).toBeVisible();
    
    // éªŒè¯è¡¨å•å…ƒç´ å­˜åœ¨
    await expect(page.getByRole('textbox', { name: /é‚®ç®±/i })).toBeVisible();
    await expect(page.getByRole('textbox', { name: /å¯†ç /i })).toBeVisible();
  });

  test('åº”è¯¥èƒ½å¤Ÿåˆ›å»ºå¼€å‘ç¯å¢ƒç®¡ç†å‘˜', async ({ page }) => {
    await page.goto('/#/admin/dev-setup');
    
    // å¡«å†™ç®¡ç†å‘˜ä¿¡æ¯
    await page.getByRole('textbox', { name: /é‚®ç®±/i }).fill('admin@test.com');
    await page.getByRole('textbox', { name: /å¯†ç /i }).fill('password123');
    
    // ç‚¹å‡»åˆ›å»ºæŒ‰é’®
    const createButton = page.getByRole('button', { name: /åˆ›å»ºç®¡ç†å‘˜/i });
    if (await createButton.isVisible()) {
      await createButton.click();
      
      // éªŒè¯æˆåŠŸæ¶ˆæ¯æˆ–é‡å®šå‘
      await page.waitForTimeout(2000);
      // è¿™é‡Œæ ¹æ®å®é™…è¡Œä¸ºéªŒè¯ç»“æœ
    }
  });

  test('åº”è¯¥èƒ½å¤Ÿç™»å½•ç®¡ç†åå°', async ({ page }) => {
    // å…ˆè®¿é—®ç™»å½•é¡µé¢
    await page.goto('/#/admin/login');
    
    // éªŒè¯ç™»å½•è¡¨å•
    await expect(page.getByRole('textbox', { name: /é‚®ç®±/i })).toBeVisible();
    await expect(page.getByRole('textbox', { name: /å¯†ç /i })).toBeVisible();
    
    // å¡«å†™ç™»å½•ä¿¡æ¯
    await page.getByRole('textbox', { name: /é‚®ç®±/i }).fill('admin@test.com');
    await page.getByRole('textbox', { name: /å¯†ç /i }).fill('password123');
    
    // ç‚¹å‡»ç™»å½•æŒ‰é’®
    await page.getByRole('button', { name: /ç™»å½•/i }).click();
    
    // ç­‰å¾…é‡å®šå‘æˆ–ç™»å½•ç»“æœ
    await page.waitForTimeout(3000);
  });

  test('åº”è¯¥èƒ½å¤Ÿè®¿é—®å†…å®¹ç®¡ç†é¡µé¢', async ({ page }) => {
    // ç›´æ¥è®¿é—®å†…å®¹ç®¡ç†é¡µé¢ï¼ˆå‡è®¾å·²ç™»å½•æˆ–ä½¿ç”¨mockï¼‰
    await page.goto('/#/admin/posts');
    
    // éªŒè¯å†…å®¹ç®¡ç†ç•Œé¢å…ƒç´ 
    const createButton = page.getByRole('button', { name: /åˆ›å»º|æ–°å»º/i });
    if (await createButton.isVisible()) {
      await expect(createButton).toBeVisible();
    }
  });

  test('åº”è¯¥èƒ½å¤Ÿåˆ›å»ºæ–°æ¸¸æˆå†…å®¹', async ({ page }) => {
    await page.goto('/#/admin/posts/create');
    
    // éªŒè¯å†…å®¹åˆ›å»ºè¡¨å•
    const titleInput = page.getByRole('textbox', { name: /æ ‡é¢˜|æ¸¸æˆåç§°/i });
    if (await titleInput.isVisible()) {
      await titleInput.fill('æµ‹è¯•æ¸¸æˆ');
      
      // å¡«å†™å…¶ä»–å¿…è¦å­—æ®µ
      const categorySelect = page.getByRole('combobox', { name: /åˆ†ç±»/i });
      if (await categorySelect.isVisible()) {
        await categorySelect.click();
        await page.getByRole('option', { name: /åŠ¨ä½œå†’é™©/i }).click();
      }
      
      // ä¿å­˜å†…å®¹
      const saveButton = page.getByRole('button', { name: /ä¿å­˜|å‘å¸ƒ/i });
      if (await saveButton.isVisible()) {
        await saveButton.click();
        await page.waitForTimeout(2000);
      }
    }
  });

  test('AIå†…å®¹ç”ŸæˆåŠŸèƒ½åº”è¯¥æ­£å¸¸å·¥ä½œ', async ({ page }) => {
    await page.goto('/#/admin/posts/create');
    
    // æŸ¥æ‰¾AIç”ŸæˆæŒ‰é’®
    const aiButton = page.getByRole('button', { name: /AI|æ™ºèƒ½ç”Ÿæˆ/i });
    if (await aiButton.isVisible()) {
      // å…ˆå¡«å†™æ¸¸æˆåç§°
      const titleInput = page.getByRole('textbox', { name: /æ ‡é¢˜|æ¸¸æˆåç§°/i });
      if (await titleInput.isVisible()) {
        await titleInput.fill('è¶…çº§é©¬é‡Œå¥¥');
      }
      
      // ç‚¹å‡»AIç”Ÿæˆ
      await aiButton.click();
      
      // ç­‰å¾…AIç”Ÿæˆå®Œæˆ
      await page.waitForTimeout(5000);
      
      // éªŒè¯ç”Ÿæˆçš„å†…å®¹
      const descriptionField = page.getByRole('textbox', { name: /æè¿°/i });
      if (await descriptionField.isVisible()) {
        const description = await descriptionField.inputValue();
        expect(description.length).toBeGreaterThan(0);
      }
    }
  });

  test('å¯Œæ–‡æœ¬ç¼–è¾‘å™¨åº”è¯¥æ­£å¸¸å·¥ä½œ', async ({ page }) => {
    await page.goto('/#/admin/posts/create');
    
    // æŸ¥æ‰¾å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
    const editor = page.locator('.ql-editor, [contenteditable="true"]');
    if (await editor.isVisible()) {
      await editor.click();
      await editor.fill('è¿™æ˜¯æµ‹è¯•å†…å®¹');
      
      // éªŒè¯å†…å®¹å·²è¾“å…¥
      await expect(editor).toHaveText(/è¿™æ˜¯æµ‹è¯•å†…å®¹/);
      
      // æµ‹è¯•éšè—å†…å®¹åŠŸèƒ½
      const hideButton = page.getByRole('button', { name: /éšè—å†…å®¹|ğŸ”’/i });
      if (await hideButton.isVisible()) {
        await hideButton.click();
        await expect(editor).toContainText('[hide]');
      }
    }
  });
});
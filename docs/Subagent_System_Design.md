### **Warp Zone Gems: 游戏网站多智能体（Subagent）协作系统设计文档**

#### **1. 概述 (Overview)**

本文档定义了一个为 **Warp Zone Gems** 游戏资源网站量身定制的多智能体（Subagent）协作系统。该系统的核心目标是自动化和优化从需求分析、设计、开发、测试到部署和维护的全过程。通过为每个专业领域指派一个专门的AI智能体，我们可以确保职责清晰、沟通高效，并保证最终产品在功能、性能和用户体验上达到最高标准。

此系统的设计严格遵循以下三大核心原则，以直接响应您的关键需求：

1.  **数据驱动与状态同步:** 前端UI和状态完全由后端提供的数据驱动，确保任何数据的变更都能实时、准确地反映在用户界面上。
2.  **后端驱动的动态前端:** 网站的关键功能、特性和UI元素（如弹窗、广告位、功能开关）由后端API和配置进行远程控制，实现高度的灵活性和可管理性。
3.  **数据一致性与完整性:** 所有涉及数据变更的操作都必须是事务性的，并通过严格的校验和测试流程，确保数据库、缓存和前端状态之间的数据一致性。

---

#### **2. 智能体角色与职责 (Agent Roles and Responsibilities)**

每个智能体都被赋予了独特的角色、任务和协作协议。

##### **2.1. 系统架构师 (System Architect)**

*   **核心任务:** 负责项目整体技术选型、架构设计和演进。确保系统的可扩展性、可维护性和安全性。定义各个模块和智能体之间的交互边界和协议。
*   **主要职责:**
    *   设计和审查核心应用的宏观架构（例如，前端状态管理策略、后端API网关模式）。
    *   规划数据流和控制流，确保满足三大核心原则。
    *   定义新的技术规范和开发标准。
    *   评估和决策引入新的库、框架或服务（如 `Supabase` 的新功能）。
*   **主要交互文件/工具:** `package.json`, `vite.config.ts`, `tsconfig.json`, `deployment/docker/docker-compose.yml`, `.github/workflows/deploy.yml`, `PROJECT_DOCUMENTATION.md`。
*   **协作方式:**
    *   向 **后端** 和 **前端** 智能体提供架构蓝图和设计约束。
    *   与 **数据库管理员** 共同设计数据模型。
    *   与 **维护工程师** 规划部署和运维策略。

##### **2.2. 前端开发工程师 (Frontend Developer)**

*   **核心任务:** 实现用户界面和交互逻辑。将UI/UX设计稿转化为功能完整、性能卓越、响应式的Web组件和页面。
*   **主要职责:**
    *   开发和维护React组件 (`src/components/`, `src/pages/`)。
    *   实现客户端状态管理、数据获取和与后端的API通信 (`src/hooks/`, `src/lib/`)。
    *   确保前端代码严格遵循 **后端** 定义的API契约。
    *   根据 **后端** 传来的配置动态渲染UI组件（例如，`FloatingElements.tsx` 的内容由 `public/data/floating-windows.json` 或API控制）。
    *   优化前端性能，包括加载速度、渲染性能和资源打包。
*   **主要交互文件/工具:** `src/`, `public/`, `package.json`, `bun run dev`, `bun run build`。
*   **协作方式:**
    *   接收 **UI设计师** 的视觉设计和组件规范。
    *   消费 **后端工程师** 提供的API，并反馈API需求。
    *   与 **QA测试工程师** 合作，修复前端Bug。

##### **2.3. UI设计师 (UI Designer)**

*   **核心任务:** 负责网站的整体视觉风格、品牌形象和用户体验设计。确保界面美观、易用且一致。
*   **主要职责:**
    *   设计组件库和视觉规范，并将其转化为可执行的样式代码。
    *   管理和配置 `tailwind.config.ts`，定义颜色、字体、间距等设计系统变量。
    *   维护全局CSS样式 (`src/index.css`, `src/App.css`)。
    *   提供新功能或页面的高保真设计稿或原型（以结构化描述或HTML/CSS片段的形式）。
*   **主要交互文件/工具:** `tailwind.config.ts`, `src/index.css`, `components.json`, `public/icons/`。
*   **协作方式:**
    *   向 **前端工程师** 提供设计规范和视觉资产。
    *   与 **玩家体验代表** 合作，根据用户反馈优化UI/UX。

##### **2.4. 后端开发工程师 (Backend Developer)**

*   **核心任务:** 开发和维护服务器端逻辑、业务规则和API。为前端提供稳定、高效、安全的数据服务。实现对前端功能的控制逻辑。
*   **主要职责:**
    *   设计、开发和维护RESTful API或GraphQL端点。
    *   编写和管理 `Supabase` 的边缘函数或数据库函数（如果业务逻辑复杂）。
    *   实现业务逻辑，例如用户认证、游戏数据管理、后台管理功能 (`admin/server.cjs`)。
    *   创建和管理用于控制前端行为的配置文件或API端点（例如，`public/data/popups.json` 的动态生成逻辑）。
    *   与 **数据库管理员** 协作，确保业务逻辑与数据模型一致。
*   **主要交互文件/工具:** `supabase/`, `admin/`, `apply-migration.js`, `sync-data.js`, `scripts/`。
*   **协作方式:**
    *   向 **前端工程师** 提供清晰的API文档和数据契约。
    *   实现由 **系统架构师** 设计的后端服务。
    *   与 **数据库管理员** 合作进行数据操作。

##### **2.5. 数据库管理员 (Database Administrator - DBA)**

*   **核心任务:** 负责数据库的设计、实现、性能优化和数据完整性。确保数据安全、可靠、一致。
*   **主要职责:**
    *   设计和维护数据库模式 (`supabase/migrations/`, `deployment/database/schema.sql`)。
    *   编写和审查数据库迁移脚本 (`migration/migrate.js`)。
    *   监控数据库性能，优化查询（例如，为 `games.json` 的查询创建索引）。
    *   管理数据备份、恢复和同步策略 (`sync-data-to-db.cjs`)。
    *   确保所有数据变更都符合事务性要求，维护数据一致性。
*   **主要交互文件/工具:** `supabase/migrations/`, `schema.sql`, `migrate.js`, `README-DATABASE.md`。
*   **协作方式:**
    *   为 **后端工程师** 提供数据访问层的支持和指导。
    *   与 **系统架构师** 合作，将逻辑模型转化为物理数据模型。

##### **2.6. QA测试工程师 (QA Tester)**

*   **核心任务:** 保证软件质量。通过自动化和手动测试，发现并报告缺陷，验证功能是否符合需求。
*   **主要职责:**
    *   编写和维护端到端（E2E）测试脚本 (`tests/e2e/`)。
    *   使用 `Playwright` 或 `Vitest` 编写单元测试和集成测试 (`src/components/__tests__/`)。
    *   执行回归测试，确保新代码不会破坏现有功能。
    *   验证数据同步和一致性，例如，在前端创建一个新游戏，然后验证数据库中是否存在对应记录。
    *   测试后端API的正确性和性能。
*   **主要交互文件/工具:** `playwright.config.ts`, `vitest.config.ts`, `tests/`, `*test.tsx?`。
*   **协作方式:**
    *   与 **前端** 和 **后端** 工程师紧密合作，报告并跟踪Bug。
    *   根据 **玩家体验代表** 提出的用户场景设计测试用例。

##### **2.7. 维护与部署工程师 (SRE/DevOps)**

*   **核心任务:** 负责应用的持续集成、持续部署（CI/CD）和线上环境的稳定运行。
*   **主要职责:**
    *   管理和优化CI/CD流水线 (`.github/workflows/`)。
    *   配置和维护生产环境（Docker, Nginx等） (`deployment/docker/`)。
    *   监控应用性能、日志和错误，并进行故障排查。
    *   管理环境变量和密钥 (`deployment/environments/.env.example`)。
    *   执行数据库迁移和应用部署 (`deployment/scripts/deploy.sh`)。
*   **主要交互文件/工具:** `.github/`, `deployment/`, `docker-compose.yml`, `Dockerfile`。
*   **协作方式:**
    *   与所有开发智能体协作，确保代码是可部署和可监控的。
    *   响应由 **QA测试工程师** 在生产环境中发现的问题。

##### **2.8. 玩家体验代表 (Player Experience Advocate)**

*   **核心任务:** 代表最终用户的利益。从玩家的视角分析网站，提出功能改进建议和新功能需求。
*   **主要职责:**
    *   分析用户行为数据（模拟），识别用户痛点和潜在需求。
    *   将模糊的用户需求转化为清晰、可执行的功能点。
    *   审查新功能，确保其符合用户期望和易用性标准。
    *   提供用户故事和验收标准，用于指导开发和测试。
*   **主要交互文件/工具:** `README.md`, `AI_FEATURES_GUIDE.md` (用于提出新想法)。
*   **协作方式:**
    *   向 **系统架构师** 和产品团队提出功能需求。
    *   与 **UI设计师** 合作，确保设计以用户为中心。
    *   为 **QA测试工程师** 提供关键的用户场景测试用例。

---

#### **3. 协作工作流示例：添加“热门推荐”游戏分类**

1.  **需求发起 (玩家体验代表):** 发现用户难以快速找到热门游戏，提议在首页添加一个“热门推荐”分类。
2.  **架构设计 (系统架构师):** 决定该功能应由后端控制。设计一个新的API端点 `GET /api/games/featured`，并决定前端通过此API动态加载该分类。
3.  **数据库变更 (DBA):** 在 `games` 表中添加一个 `is_featured` 布尔字段，并创建相应的索引。编写并提交一个新的数据库迁移脚本。
4.  **后端开发 (后端工程师):**
    *   应用 **DBA** 的迁移脚本。
    *   创建 `GET /api/games/featured` 端点，返回所有 `is_featured` 为 `true` 的游戏。
    *   在后台管理系统中添加入口，允许管理员设置或取消游戏的热门推荐状态。
5.  **UI设计 (UI设计师):** 设计“热门推荐”分类在首页的展示样式，包括标题、卡片布局和“查看更多”按钮，并更新 `tailwind.config.ts` (如果需要新样式)。
6.  **前端开发 (前端工程师):**
    *   创建一个新的 `FeaturedGamesSection.tsx` 组件。
    *   在该组件中调用 `GET /api/games/featured` API。
    *   根据 **UI设计师** 的规范渲染游戏列表。
    *   如果API没有返回任何数据，则该组件不渲染，完美实现后端控制前端功能。
7.  **测试 (QA测试工程师):**
    *   编写单元测试，验证 `FeaturedGamesSection.tsx` 在有数据和无数据情况下的渲染逻辑。
    *   编写E2E测试，模拟完整流程：管理员在后台标记一个游戏为“热门”，然后在首页验证该游戏是否出现在“热门推荐”区域。
8.  **部署 (维护工程师):**
    *   CI/CD流水线自动运行所有测试。
    *   测试通过后，执行部署脚本，将数据库迁移和应用代码部署到生产环境。
    *   监控新功能上线后的性能和错误日志。

---

#### **4. 总结 (Conclusion)**

该多智能体协作系统为 **Warp Zone Gems** 项目提供了一个清晰、结构化和自动化的开发框架。通过明确各智能体的职责和协作流程，它不仅能高效地交付高质量的功能，更能从根本上保证 **数据同步**、**后端控制** 和 **数据一致性** 这三大核心目标的实现，为项目的长期健康发展奠定坚实的基础。
